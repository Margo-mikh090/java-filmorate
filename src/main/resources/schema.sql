CREATE TABLE IF NOT EXISTS USERS
(
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    EMAIL VARCHAR(50) NOT NULL,
    LOGIN VARCHAR(50) NOT NULL,
    NAME VARCHAR(50) NOT NULL,
    BIRTHDAY DATE,
    CONSTRAINT USERS_UNIQUE_EMAIL UNIQUE (EMAIL),
    CONSTRAINT USERS_UNIQUE_LOGIN UNIQUE (LOGIN)
);

CREATE TABLE IF NOT EXISTS MPA
(
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR(50) NOT NULL
);

CREATE TABLE IF NOT EXISTS FILMS
(
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR(50) NOT NULL,
    DESCRIPTION VARCHAR(200),
    RELEASE_DATE DATE,
    DURATION BIGINT,
    MPA_ID BIGINT REFERENCES MPA (ID) ON DELETE RESTRICT ON UPDATE RESTRICT
);

CREATE TABLE IF NOT EXISTS GENRES
(
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR(50) NOT NULL
);

CREATE TABLE IF NOT EXISTS FILM_GENRES
(
    FILM_ID  BIGINT REFERENCES FILMS (ID) ON DELETE CASCADE ON UPDATE RESTRICT,
    GENRE_ID BIGINT REFERENCES GENRES (ID) ON DELETE RESTRICT ON UPDATE RESTRICT,
    CONSTRAINT FILM_GENRES_PK PRIMARY KEY (FILM_ID, GENRE_ID)
);

CREATE TABLE IF NOT EXISTS LIKES
(
    USER_ID BIGINT REFERENCES USERS (ID) ON DELETE CASCADE ON UPDATE RESTRICT,
    FILM_ID BIGINT REFERENCES FILMS (ID) ON DELETE CASCADE ON UPDATE RESTRICT,
    CONSTRAINT LIKES_PK PRIMARY KEY (USER_ID, FILM_ID)
);

CREATE TABLE IF NOT EXISTS FRIENDSHIP
(
    FIRST_USER_ID BIGINT REFERENCES USERS (ID) ON DELETE CASCADE ON UPDATE RESTRICT,
    SECOND_USER_ID BIGINT REFERENCES USERS (ID) ON DELETE CASCADE ON UPDATE RESTRICT,
    CONSTRAINT FRIENDS_PK PRIMARY KEY (FIRST_USER_ID, SECOND_USER_ID)
);

CREATE TABLE IF NOT EXISTS reviews
(
    review_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    content TEXT NOT NULL,
    is_positive BOOLEAN NOT NULL,
    user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    film_id BIGINT NOT NULL REFERENCES films(id) ON DELETE CASCADE,
    useful INT DEFAULT 0
);

CREATE TABLE IF NOT EXISTS review_likes
(
    review_id BIGINT NOT NULL REFERENCES reviews(review_id) ON DELETE CASCADE,
    user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    is_positive BOOLEAN NOT NULL,
    PRIMARY KEY (review_id, user_id)
);

CREATE TABLE IF NOT EXISTS DIRECTOR
(
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR(50) NOT NULL
);

CREATE TABLE IF NOT EXISTS FILM_DIRECTOR
(
    FILM_ID  BIGINT REFERENCES FILMS (ID) ON DELETE CASCADE ON UPDATE RESTRICT,
    DIRECTOR_ID BIGINT REFERENCES DIRECTOR (ID) ON DELETE RESTRICT ON UPDATE RESTRICT,
    CONSTRAINT FILM_DIRECTOR_PK PRIMARY KEY (FILM_ID, DIRECTOR_ID)
);